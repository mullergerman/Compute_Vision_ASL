# Telegraf - HTTP ingest for backend metrics -> InfluxDB v2 (Podman pod)
[agent]
  interval = "10s"
  round_interval = true
  flush_interval = "1s"
  metric_buffer_limit = 50000
  flush_jitter = "0s"
  collection_jitter = "0s"
  debug = false
  quiet = false
  logfile = ""

# HTTP JSON ingestion for backend metrics
[[inputs.http_listener_v2]]
  service_address = ":8090"
  paths = ["/backend"]
  methods = ["POST"]
  read_timeout  = "10s"
  write_timeout = "10s"
  max_body_size = "5MB"
  data_source = "body"
  data_format = "json"
  json_name_key    = "measurement"
  json_time_key    = "ts"
  json_time_format = "unix_ms"
  tag_keys = ["instance","service"]

# Forward to InfluxDB v2 - SAME POD NETWORK (localhost)
[[outputs.influxdb_v2]]
  urls          = ["http://127.0.0.1:8086"]
  token         = "example-token"
  organization  = "example-org"
  bucket        = "example-bucket"
  precision     = "ms"
